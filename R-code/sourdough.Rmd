---
title: "Scatterplots Of Unselected Regression Dimensions Ostensibly Uncovering Group Hierarchies"
output: html_document
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message = FALSE)
```

Read in the posterior draws of MCMC

``` {r, results='none'}
library(faraway)
library(tidyverse)
library(plotly)
library(magrittr)
posterior <- read_csv("posterior_summary/thinned_MCMC.csv") # x1 is the row name
```

Which variables are zero more often than others?

``` {r}
head(posterior,10)

select(posterior, starts_with("ind"),X1) %>%
  gather(key, value, -X1) %>%
  group_by(key) %>%
  summarise(non_zero_freq =  mean(value))
```

We wish to set a visualisation up for three variables that indicate the relationship between these variables when they are non-zero and when they are zero. In this case, we have eight particularly states for whether each variable is zero or not. We draw inspiration from the `chmod` permission sytem

``` {r, echo=T, fig.cap="Eight states of regression weights for three indicator parameters"}
expand.grid(x1 =c(0,1), x2=c(0,1), x3=c(0,1)) %>%
  rowwise %>%
  mutate(Group = sum(c(x1, x2, x3) * c(4,2,1))) %>%
  arrange(Group) %>%
  kable
```



``` {r echo=FALSE}
is.zero <- function(x){
  
  return(sum((x != 0) * c(4,2,1)))
  
}



to_plot <- transmute(posterior, 
                     x = `betaT[5]`*`Ind[5]`, 
                     y = `betaT[9]`*`Ind[9]`,
                     z = `betaT[15]`*`Ind[15]`) %>%
  mutate(sample =1:nrow(.)) %>%
  split(.$sample) %>%
  map_df(~mutate(.x, indicator = is.zero(.x[,1:3])))

to_plot %<>% mutate(bread = c("Donut hole",
                              "Grissini 1",
                              "Grissini 2",
                              "Pita 1",
                              "Grissini 3",
                              "Pita 2",
                              "Pita 3",
                              "Dinner roll")[indicator + 1])

with(to_plot, plot_ly (type = "scatter3d",
                       x = x, 
                       y = y,
                       z = z,
                       mode="markers",
                       color=bread,
                       opacity = 0.25)) %>%
  layout(scene = list(xaxis = list(title = "beta[5]"),
                      yaxis = list(title = "beta[9]"),
                      zaxis = list(title = "beta[15]"),
                      title = 'points only'))
```

``` {r, include=FALSE, eval=FALSE, echo=FALSE}
select(posterior, starts_with('beta')) %>%
  mutate(idx =1:nrow(.)) %>%
  gather(key, value, -idx) %>%
  ggplot(data=., aes(x=idx, y=value)) +
  geom_line() +
  facet_wrap(~ key)

select(posterior, starts_with('Ind')) %>%
  mutate(idx =1:nrow(.)) %>%
  gather(key, value, -idx) %>%
  group_by(key) %>%
  summarise(Inclusion = mean(value)) %>%
  mutate(realkey = parse_number(key)) %>%
  ggplot(data=., aes(x=realkey, y=Inclusion)) +
  geom_col()

```

